(function(){angular.module("app",["ngRoute","chart.js","app.common","app.auth","app.landing","app.home","app.pollDashboard"]).config(e).run(t);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){t.html5Mode(true);e.otherwise({redirectTo:"/"})}t.$inject=["$rootScope","$location"];function t(e,t){e.$on("$routeChangeError",function(e,n,o,r){if(r==="Authorization Required"){t.path("/login")}})}})();(function(){angular.module("app.common",[])})();(function(){angular.module("app.common").factory("pollsService",e);e.$inject=["$http","authentication"];function e(e,t){function n(){return e.get("/api/polls")}function o(t){return e.get("/api/polls/"+t)}function r(t){return e.get("/api/polls/user/"+t)}function l(n){return e.post("/api/polls",n,{headers:{Authorization:"Bearer "+t.getToken()}})}function a(n,o){return e.post("/api/polls/"+o+"/choices",n,{headers:{Authorization:"Bearer "+t.getToken()}})}function i(n){return e.delete("/api/polls/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})}function c(t,n){return e.delete("/api/polls/"+t+"/choices/"+n)}function u(t,n){return e.put("/api/polls/"+t+"/choices/"+n)}return{getPolls:n,getOnePoll:o,getPollsByUserId:r,createPoll:l,createPollChoice:a,deletePoll:i,deletePollChoice:c,updateVote:u}}})();(function(){angular.module("app.common").service("authentication",e);e.$inject=["$window","$http","$q"];function e(e,t,n){function o(t){e.localStorage["poll-token"]=t}function r(){return e.localStorage["poll-token"]}function l(e){var r=n.defer();t.post("/api/register",e).then(function(e){console.log(e);o(e.data.token);r.resolve(e.data)}).catch(function(e){console.log(e);r.reject(e)});return r.promise}function a(e){var r=n.defer();t.post("/api/login",e).then(function(e){o(e.data.token);r.resolve(e.data)}).catch(function(e){r.reject(e)});return r.promise}function i(){var t=r();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}}function c(){if(i()){var t=r();var n=JSON.parse(e.atob(t.split(".")[1]));return{id:n._id,email:n.email,name:n.name}}}function u(){e.localStorage.removeItem("poll-token")}return{saveToken:o,getToken:r,register:l,login:a,logout:u,isLoggedIn:i,currentUser:c}}})();(function(){"use strict";angular.module("app.common").directive("plNavbar",e);function e(){return{templateUrl:"/common/directives/navbar.html",restrict:"E",controller:t,controllerAs:"vm"}}t.$inject=["$rootScope","$location","authentication"];function t(e,t,n){var o=this;o.isLoggedIn=n.isLoggedIn();o.currentUser=n.currentUser();o.logout=function(){n.logout();t.path("/")};e.$on("$routeChangeSuccess",function(e,t){o.isLoggedIn=n.isLoggedIn();o.currentUser=n.currentUser()})}})();(function(){angular.module("app.common").directive("plFooter",e);function e(){return{templateUrl:"/common/directives/footer.html",restrict:"E"}}})();(function(e,t,n){"use strict";function o(e,n,o){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(r,l,a,i,c){function u(){f&&(o.cancel(f),f=null);h&&(h.$destroy(),h=null);p&&(f=o.leave(p),f.then(function(){f=null}),p=null)}function s(){var a=e.current&&e.current.locals;if(t.isDefined(a&&a.$template)){var a=r.$new(),i=e.current;p=c(a,function(e){o.enter(e,null,p||l).then(function(){!t.isDefined(d)||d&&!r.$eval(d)||n()});u()});h=i.scope=a;h.$emit("$viewContentLoaded");h.$eval(g)}else u()}var h,p,f,d=a.autoscroll,g=a.onload||"";r.$on("$routeChangeSuccess",s);s()}}}function r(e,t,n){return{restrict:"ECA",priority:-400,link:function(o,r){var l=n.current,a=l.locals;r.html(a.$template);var i=e(r.contents());if(l.controller){a.$scope=o;var c=t(l.controller,a);l.controllerAs&&(o[l.controllerAs]=c);r.data("$ngControllerController",c);r.children().data("$ngControllerController",c)}o[l.resolveAs||"$resolve"]=a;i(o)}}}e=t.module("ngRoute",["ng"]).provider("$route",function(){function e(e,n){return t.extend(Object.create(e),n)}function n(e,t){var n=t.caseInsensitiveMatch,o={originalPath:e,regexp:e},r=o.keys=[];e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,n,o){e="?"===o?o:null;o="*"===o?o:null;r.push({name:n,optional:!!e});t=t||"";return""+(e?"":t)+"(?:"+(e?t:"")+(o&&"(.+?)"||"([^/]+)")+(e||"")+")"+(e||"")}).replace(/([\/$\*])/g,"\\$1");o.regexp=new RegExp("^"+e+"$",n?"i":"");return o}var o={};this.when=function(e,r){var l=t.copy(r);t.isUndefined(l.reloadOnSearch)&&(l.reloadOnSearch=!0);t.isUndefined(l.caseInsensitiveMatch)&&(l.caseInsensitiveMatch=this.caseInsensitiveMatch);o[e]=t.extend(l,e&&n(e,l));if(e){var a="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";o[a]=t.extend({redirectTo:e},n(a,l))}return this};this.caseInsensitiveMatch=!1;this.otherwise=function(e){"string"===typeof e&&(e={redirectTo:e});this.when(null,e);return this};this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(n,r,a,i,c,u,s){function h(e){var o=$.current;(m=(v=f())&&o&&v.$$route===o.$$route&&t.equals(v.pathParams,o.pathParams)&&!v.reloadOnSearch&&!g)||!o&&!v||n.$broadcast("$routeChangeStart",v,o).defaultPrevented&&e&&e.preventDefault()}function p(){var e=$.current,o=v;if(m)e.params=o.params,t.copy(e.params,a),n.$broadcast("$routeUpdate",e);else if(o||e)g=!1,($.current=o)&&o.redirectTo&&(t.isString(o.redirectTo)?r.path(d(o.redirectTo,o.params)).search(o.params).replace():r.url(o.redirectTo(o.pathParams,r.path(),r.search())).replace()),i.when(o).then(function(){if(o){var e=t.extend({},o.resolve),n,r;t.forEach(e,function(n,o){e[o]=t.isString(n)?c.get(n):c.invoke(n,null,null,o)});t.isDefined(n=o.template)?t.isFunction(n)&&(n=n(o.params)):t.isDefined(r=o.templateUrl)&&(t.isFunction(r)&&(r=r(o.params)),t.isDefined(r)&&(o.loadedTemplateUrl=s.valueOf(r),n=u(r)));t.isDefined(n)&&(e.$template=n);return i.all(e)}}).then(function(r){o==$.current&&(o&&(o.locals=r,t.copy(o.params,a)),n.$broadcast("$routeChangeSuccess",o,e))},function(t){o==$.current&&n.$broadcast("$routeChangeError",o,e,t)})}function f(){var n,l;t.forEach(o,function(o,a){var i;if(i=!l){var c=r.path();i=o.keys;var u={};if(o.regexp)if(c=o.regexp.exec(c)){for(var s=1,h=c.length;s<h;++s){var p=i[s-1],f=c[s];p&&f&&(u[p.name]=f)}i=u}else i=null;else i=null;i=n=i}i&&(l=e(o,{params:t.extend({},r.search(),n),pathParams:n}),l.$$route=o)});return l||o[null]&&e(o[null],{params:{},pathParams:{}})}function d(e,n){var o=[];t.forEach((e||"").split(":"),function(e,t){if(0===t)o.push(e);else{var r=e.match(/(\w+)(?:[?*])?(.*)/),l=r[1];o.push(n[l]);o.push(r[2]||"");delete n[l]}});return o.join("")}var g=!1,v,m,$={routes:o,reload:function(){g=!0;n.$evalAsync(function(){h();p()})},updateParams:function(e){if(this.current&&this.current.$$route)e=t.extend({},this.current.params,e),r.path(d(this.current.$$route.originalPath,e)),r.search(e);else throw l("norout")}};n.$on("$locationChangeStart",h);n.$on("$locationChangeSuccess",p);return $}]});var l=t.$$minErr("ngRoute");e.provider("$routeParams",function(){this.$get=function(){return{}}});e.directive("ngView",o);e.directive("ngView",r);o.$inject=["$route","$anchorScroll","$animate"];r.$inject=["$compile","$controller","$route"]})(window,window.angular);!function(e){"use strict";"object"==typeof exports?module.exports=e("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof Chart?Chart:require("chart.js")):"function"==typeof define&&define.amd?define(["angular","chart"],e):e(angular,Chart)}(function(e,t){"use strict";function n(){var n={},o={Chart:t,getOptions:function(t){var o=t&&n[t]||{};return e.extend({},n,o)}};this.setOptions=function(t,o){return o?void(n[t]=e.extend(n[t]||{},o)):(o=t,void(n=e.extend(n,o)))},this.$get=function(){return o}}function o(n,o){function l(e,t){return e&&t&&e.length&&t.length?Array.isArray(e[0])?e.length===t.length&&e.every(function(e,n){return e.length===t[n].length}):t.reduce(a,0)>0?e.length===t.length:!1:!1}function a(e,t){return e+t}function i(t,n,o,r){var l=null;return function(a){var i=n.getPointsAtEvent||n.getBarsAtEvent||n.getSegmentsAtEvent;if(i){var c=i.call(n,a);(r===!1||e.equals(l,c)===!1)&&(l=c,t[o](c,a),t.$apply())}}}function c(o,r){for(var l=e.copy(r.colours||n.getOptions(o).colours||t.defaults.global.colours);l.length<r.data.length;)l.push(r.getColour());return l.map(u)}function u(e){return"object"==typeof e&&null!==e?e:"string"==typeof e&&"#"===e[0]?h(d(e.substr(1))):s()}function s(){var e=[p(0,255),p(0,255),p(0,255)];return h(e)}function h(e){return{fillColor:f(e,.2),strokeColor:f(e,1),pointColor:f(e,1),pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:f(e,.8)}}function p(e,t){return Math.floor(Math.random()*(t-e+1))+e}function f(e,t){return r?"rgb("+e.join(",")+")":"rgba("+e.concat(t).join(",")+")"}function d(e){var t=parseInt(e,16),n=t>>16&255,o=t>>8&255,r=255&t;return[n,o,r]}function g(t,n,o,r){return{labels:t,datasets:n.map(function(t,n){return e.extend({},r[n],{label:o[n],data:t})})}}function v(t,n,o){return t.map(function(t,r){return e.extend({},o[r],{label:t,value:n[r],color:o[r].strokeColor,highlight:o[r].pointHighlightStroke})})}function m(e,t){var n=e.parent(),o=n.find("chart-legend"),r="<chart-legend>"+t.generateLegend()+"</chart-legend>";o.length?o.replaceWith(r):n.append(r)}function $(e,t,n,o){Array.isArray(n.data[0])?e.datasets.forEach(function(e,n){(e.points||e.bars).forEach(function(e,o){e.value=t[n][o]})}):e.segments.forEach(function(e,n){e.value=t[n]}),e.update(),n.$emit("update",e),n.legend&&"false"!==n.legend&&m(o,e)}function C(e){return!e||Array.isArray(e)&&!e.length||"object"==typeof e&&!Object.keys(e).length}function w(o,r){var l=e.extend({},t.defaults.global,n.getOptions(o),r.options);return l.responsive}return function(t){return{restrict:"CA",scope:{data:"=?",labels:"=?",options:"=?",series:"=?",colours:"=?",getColour:"=?",chartType:"=",legend:"@",click:"=?",hover:"=?",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColours:"=?",chartLegend:"@",chartClick:"=?",chartHover:"=?"},link:function(a,u){function h(e,t){a.$watch(e,function(e){"undefined"!=typeof e&&(a[t]=e)})}function p(n,o){if(!C(n)&&!e.equals(n,o)){var r=t||a.chartType;r&&(b&&b.destroy(),f(r))}}function f(t){if(w(t,a)&&0===u[0].clientHeight&&0===y.clientHeight)return o(function(){f(t)},50,!1);if(a.data&&a.data.length){a.getColour="function"==typeof a.getColour?a.getColour:s,a.colours=c(t,a);var r=u[0],l=r.getContext("2d"),h=Array.isArray(a.data[0])?g(a.labels,a.data,a.series||[],a.colours):v(a.labels,a.data,a.colours),p=e.extend({},n.getOptions(t),a.options);b=new n.Chart(l)[t](h,p),a.$emit("create",b),r.onclick=a.click?i(a,b,"click",!1):e.noop,r.onmousemove=a.hover?i(a,b,"hover",!0):e.noop,a.legend&&"false"!==a.legend&&m(u,b)}}function d(e){if("undefined"!=typeof console&&"test"!==n.getOptions().env){var t="function"==typeof console.warn?console.warn:console.log;a[e]&&t.call(console,'"%s" is deprecated and will be removed in a future version. Please use "chart-%s" instead.',e,e)}}var b,y=document.createElement("div");y.className="chart-container",u.replaceWith(y),y.appendChild(u[0]),r&&window.G_vmlCanvasManager.initElement(u[0]),["data","labels","options","series","colours","legend","click","hover"].forEach(d),h("chartData","data"),h("chartLabels","labels"),h("chartOptions","options"),h("chartSeries","series"),h("chartColours","colours"),h("chartLegend","legend"),h("chartClick","click"),h("chartHover","hover"),a.$watch("data",function(e,n){if(e&&e.length&&(!Array.isArray(e[0])||e[0].length)){var o=t||a.chartType;if(o){if(b){if(l(e,n))return $(b,e,a,u);b.destroy()}f(o)}}},!0),a.$watch("series",p,!0),a.$watch("labels",p,!0),a.$watch("options",p,!0),a.$watch("colours",p,!0),a.$watch("chartType",function(t,n){C(t)||e.equals(t,n)||(b&&b.destroy(),f(t))}),a.$on("$destroy",function(){b&&b.destroy()})}}}}t.defaults.global.responsive=!0,t.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>",t.defaults.global.colours=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var r="object"==typeof window.G_vmlCanvasManager&&null!==window.G_vmlCanvasManager&&"function"==typeof window.G_vmlCanvasManager.initElement;return r&&(t.defaults.global.animation=!1),e.module("chart.js",[]).provider("ChartJs",n).factory("ChartJsFactory",["ChartJs","$timeout",o]).directive("chartBase",["ChartJsFactory",function(e){return new e}]).directive("chartLine",["ChartJsFactory",function(e){return new e("Line")}]).directive("chartBar",["ChartJsFactory",function(e){return new e("Bar")}]).directive("chartRadar",["ChartJsFactory",function(e){return new e("Radar")}]).directive("chartDoughnut",["ChartJsFactory",function(e){return new e("Doughnut")}]).directive("chartPie",["ChartJsFactory",function(e){return new e("Pie")}]).directive("chartPolarArea",["ChartJsFactory",function(e){return new e("PolarArea")}])});(function(){angular.module("app.landing",[])})();(function(){angular.module("app.landing").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/",{templateUrl:"/landing/landing.html"})}})();(function(){angular.module("app.landing").controller("landingController",e);e.$inject=["authentication"];function e(e){vm.isLoggedIn=e.isLoggedIn()}})();(function(){angular.module("app.home",[])})();(function(){angular.module("app.home").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/home",{templateUrl:"/home/home.html",controller:"homeController",controllerAs:"vm"});e.when("/home/result/:pollid",{templateUrl:"/home/homeResult.html",controller:"homeResultController",controllerAs:"vm"})}})();(function(){angular.module("app.home").controller("homeController",e);e.$inject=["pollsService","$location"];function e(e,t){var n=this;n.polls;n.userChoices=[];n.vote=function(o,r){var l;var a;if(typeof n.userChoices[r]!=="object"){a=o.choices[parseInt(n.userChoices[r])]._id;l=o._id;e.updateVote(l,a).then(function(e){t.path("/home/result/"+o._id)}).catch(function(e){})}};n.results=function(e){t.path("/home/result/"+e._id)};function o(){return e.getPolls().then(function(e){n.polls=e.data;angular.forEach(n.polls,function(){n.userChoices.push({})})}).catch(function(e){console.log("Polls were not able to be returned "+e)})}o()}})();(function(){angular.module("app.home").controller("homeResultController",e);e.$inject=["$routeParams","pollsService"];function e(e,t){var n=this;n.labels=[];n.data=[];n.poll;function o(){t.getOnePoll(e.pollid).then(function(e){var t=[];n.poll=e.data;angular.forEach(n.poll.choices,function(e,o){n.labels.push(e.answer);t.push(e.votes)});n.data.push(t)}).catch(function(e){console.log("poll was not retrieved "+e)})}o()}})();(function(){angular.module("app.pollDashboard",[])})();(function(){angular.module("app.pollDashboard").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/dashboard",{templateUrl:"/pollDashBoard/pollDashboard.html",controller:"pollDashboardController",controllerAs:"vm",resolve:{user:t}});e.when("/dashboard/polls",{templateUrl:"/pollDashBoard/userPolls.html",controller:"userPollsController",controllerAs:"vm",resolve:{user:t}});e.when("/dashboard/polls/edit/:pollid",{templateUrl:"/pollDashBoard/editPoll.html",controller:"editPollController",controllerAs:"vm",resolve:{user:t}})}t.$inject=["authentication","$q"];function t(e,t){var n=t.defer();if(e.isLoggedIn()){n.resolve(true)}else{n.reject("Authorization Required")}return n.promise}})();(function(){angular.module("app.pollDashboard").controller("pollDashboardController",e);e.$inject=["pollsService","$timeout"];function e(e,t){var n=this;n.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};n.isCreated=null;n.addMoreChoice=function(){if(n.poll.choices.length<5){n.poll.choices.push({answer:"",votes:0})}};n.removeChoice=function(e){if(n.poll.choices.length>2){n.poll.choices.splice(e,1)}};n.submitPoll=function(){return e.createPoll(n.poll).then(function(e){console.log("poll was created");n.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};n.isCreated=true;t(function(){n.isCreated=null},1500)}).catch(function(e){console.log(e);n.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};n.isCreated=false;t(function(){n.isCreated=null},1500)})}}})();(function(){angular.module("app.pollDashboard").controller("userPollsController",e);e.$inject=["pollsService","authentication","$location"];function e(e,t,n){var o=this;o.userPolls;o.pollshare=null;o.editPoll=function(e){n.path("/dashboard/polls/edit/"+e)};o.deletePoll=function(t){return e.deletePoll(t).then(function(e){r();console.log("poll was successfully deleted "+e)}).catch(function(e){console.log("unable to delete poll "+e)})};function r(){return e.getPollsByUserId(t.currentUser().id).then(function(e){o.userPolls=e.data}).catch(function(e){console.log(e)})}r()}})();(function(){angular.module("app.pollDashboard").controller("editPollController",e);e.$inject=["$routeParams","pollsService"];function e(e,t){var n=this;n.poll;n.newChoice={answer:"",votes:0};n.addChoice=function(){if(n.newChoice.answer!==""){t.createPollChoice(n.newChoice,e.pollid).then(function(e){console.log(e);o();n.newChoice={answer:"",votes:0}}).catch(function(e){console.log(e)})}};function o(){t.getOnePoll(e.pollid).then(function(e){n.poll=e.data}).catch(function(e){console.log(e)})}o()}})();(function(){"use strict";angular.module("app.auth",[])})();(function(){"use strict";angular.module("app.auth").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/register",{templateUrl:"/auth/register.html",controller:"registerController",controllerAs:"vm"});e.when("/login",{templateUrl:"/auth/login.html",controller:"loginController",controllerAs:"vm"})}})();(function(){"use strict";angular.module("app.auth").controller("registerController",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.user={name:"",email:"",password:""};n.error=null;n.register=function(){t.register(n.user).then(function(t){e.path("/dashboard")}).catch(function(e){n.error=e.statusText})}}})();(function(){"use strict";angular.module("app.auth").controller("loginController",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.user={email:"",password:""};n.error=null;n.login=function(){t.login(n.user).then(function(t){e.path("/dashboard/polls")}).catch(function(e){n.error=e.statusText})}}})();