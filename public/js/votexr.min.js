(function(){"use strict";angular.module("app",["ngRoute","chart.js","app.auth","app.common","app.pollDashboard","app.landing","app.home"]).config(e).run(t);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){t.html5Mode(true);e.otherwise({redirectTo:"/"})}t.$inject=["$rootScope","$location"];function t(e,t){e.$on("$routeChangeError",function(e,o,n,r){if(r==="Authorization Required"){t.path("/login")}})}})();(function(e,t,o){"use strict";function n(e,o,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(r,l,a,i,c){function s(){d&&(n.cancel(d),d=null);h&&(h.$destroy(),h=null);p&&(d=n.leave(p),d.then(function(){d=null}),p=null)}function u(){var a=e.current&&e.current.locals;if(t.isDefined(a&&a.$template)){var a=r.$new(),i=e.current;p=c(a,function(e){n.enter(e,null,p||l).then(function(){!t.isDefined(f)||f&&!r.$eval(f)||o()});s()});h=i.scope=a;h.$emit("$viewContentLoaded");h.$eval(g)}else s()}var h,p,d,f=a.autoscroll,g=a.onload||"";r.$on("$routeChangeSuccess",u);u()}}}function r(e,t,o){return{restrict:"ECA",priority:-400,link:function(n,r){var l=o.current,a=l.locals;r.html(a.$template);var i=e(r.contents());if(l.controller){a.$scope=n;var c=t(l.controller,a);l.controllerAs&&(n[l.controllerAs]=c);r.data("$ngControllerController",c);r.children().data("$ngControllerController",c)}n[l.resolveAs||"$resolve"]=a;i(n)}}}e=t.module("ngRoute",["ng"]).provider("$route",function(){function e(e,o){return t.extend(Object.create(e),o)}function o(e,t){var o=t.caseInsensitiveMatch,n={originalPath:e,regexp:e},r=n.keys=[];e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,o,n){e="?"===n?n:null;n="*"===n?n:null;r.push({name:o,optional:!!e});t=t||"";return""+(e?"":t)+"(?:"+(e?t:"")+(n&&"(.+?)"||"([^/]+)")+(e||"")+")"+(e||"")}).replace(/([\/$\*])/g,"\\$1");n.regexp=new RegExp("^"+e+"$",o?"i":"");return n}var n={};this.when=function(e,r){var l=t.copy(r);t.isUndefined(l.reloadOnSearch)&&(l.reloadOnSearch=!0);t.isUndefined(l.caseInsensitiveMatch)&&(l.caseInsensitiveMatch=this.caseInsensitiveMatch);n[e]=t.extend(l,e&&o(e,l));if(e){var a="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";n[a]=t.extend({redirectTo:e},o(a,l))}return this};this.caseInsensitiveMatch=!1;this.otherwise=function(e){"string"===typeof e&&(e={redirectTo:e});this.when(null,e);return this};this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(o,r,a,i,c,s,u){function h(e){var n=$.current;(v=(m=d())&&n&&m.$$route===n.$$route&&t.equals(m.pathParams,n.pathParams)&&!m.reloadOnSearch&&!g)||!n&&!m||o.$broadcast("$routeChangeStart",m,n).defaultPrevented&&e&&e.preventDefault()}function p(){var e=$.current,n=m;if(v)e.params=n.params,t.copy(e.params,a),o.$broadcast("$routeUpdate",e);else if(n||e)g=!1,($.current=n)&&n.redirectTo&&(t.isString(n.redirectTo)?r.path(f(n.redirectTo,n.params)).search(n.params).replace():r.url(n.redirectTo(n.pathParams,r.path(),r.search())).replace()),i.when(n).then(function(){if(n){var e=t.extend({},n.resolve),o,r;t.forEach(e,function(o,n){e[n]=t.isString(o)?c.get(o):c.invoke(o,null,null,n)});t.isDefined(o=n.template)?t.isFunction(o)&&(o=o(n.params)):t.isDefined(r=n.templateUrl)&&(t.isFunction(r)&&(r=r(n.params)),t.isDefined(r)&&(n.loadedTemplateUrl=u.valueOf(r),o=s(r)));t.isDefined(o)&&(e.$template=o);return i.all(e)}}).then(function(r){n==$.current&&(n&&(n.locals=r,t.copy(n.params,a)),o.$broadcast("$routeChangeSuccess",n,e))},function(t){n==$.current&&o.$broadcast("$routeChangeError",n,e,t)})}function d(){var o,l;t.forEach(n,function(n,a){var i;if(i=!l){var c=r.path();i=n.keys;var s={};if(n.regexp)if(c=n.regexp.exec(c)){for(var u=1,h=c.length;u<h;++u){var p=i[u-1],d=c[u];p&&d&&(s[p.name]=d)}i=s}else i=null;else i=null;i=o=i}i&&(l=e(n,{params:t.extend({},r.search(),o),pathParams:o}),l.$$route=n)});return l||n[null]&&e(n[null],{params:{},pathParams:{}})}function f(e,o){var n=[];t.forEach((e||"").split(":"),function(e,t){if(0===t)n.push(e);else{var r=e.match(/(\w+)(?:[?*])?(.*)/),l=r[1];n.push(o[l]);n.push(r[2]||"");delete o[l]}});return n.join("")}var g=!1,m,v,$={routes:n,reload:function(){g=!0;o.$evalAsync(function(){h();p()})},updateParams:function(e){if(this.current&&this.current.$$route)e=t.extend({},this.current.params,e),r.path(f(this.current.$$route.originalPath,e)),r.search(e);else throw l("norout")}};o.$on("$locationChangeStart",h);o.$on("$locationChangeSuccess",p);return $}]});var l=t.$$minErr("ngRoute");e.provider("$routeParams",function(){this.$get=function(){return{}}});e.directive("ngView",n);e.directive("ngView",r);n.$inject=["$route","$anchorScroll","$animate"];r.$inject=["$compile","$controller","$route"]})(window,window.angular);!function(e){"use strict";"object"==typeof exports?module.exports=e("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof Chart?Chart:require("chart.js")):"function"==typeof define&&define.amd?define(["angular","chart"],e):e(angular,Chart)}(function(e,t){"use strict";function o(){var o={},n={Chart:t,getOptions:function(t){var n=t&&o[t]||{};return e.extend({},o,n)}};this.setOptions=function(t,n){return n?void(o[t]=e.extend(o[t]||{},n)):(n=t,void(o=e.extend(o,n)))},this.$get=function(){return n}}function n(o,n){function l(e,t){return e&&t&&e.length&&t.length?Array.isArray(e[0])?e.length===t.length&&e.every(function(e,o){return e.length===t[o].length}):t.reduce(a,0)>0?e.length===t.length:!1:!1}function a(e,t){return e+t}function i(t,o,n,r){var l=null;return function(a){var i=o.getPointsAtEvent||o.getBarsAtEvent||o.getSegmentsAtEvent;if(i){var c=i.call(o,a);(r===!1||e.equals(l,c)===!1)&&(l=c,t[n](c,a),t.$apply())}}}function c(n,r){for(var l=e.copy(r.colours||o.getOptions(n).colours||t.defaults.global.colours);l.length<r.data.length;)l.push(r.getColour());return l.map(s)}function s(e){return"object"==typeof e&&null!==e?e:"string"==typeof e&&"#"===e[0]?h(f(e.substr(1))):u()}function u(){var e=[p(0,255),p(0,255),p(0,255)];return h(e)}function h(e){return{fillColor:d(e,.2),strokeColor:d(e,1),pointColor:d(e,1),pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:d(e,.8)}}function p(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(e,t){return r?"rgb("+e.join(",")+")":"rgba("+e.concat(t).join(",")+")"}function f(e){var t=parseInt(e,16),o=t>>16&255,n=t>>8&255,r=255&t;return[o,n,r]}function g(t,o,n,r){return{labels:t,datasets:o.map(function(t,o){return e.extend({},r[o],{label:n[o],data:t})})}}function m(t,o,n){return t.map(function(t,r){return e.extend({},n[r],{label:t,value:o[r],color:n[r].strokeColor,highlight:n[r].pointHighlightStroke})})}function v(e,t){var o=e.parent(),n=o.find("chart-legend"),r="<chart-legend>"+t.generateLegend()+"</chart-legend>";n.length?n.replaceWith(r):o.append(r)}function $(e,t,o,n){Array.isArray(o.data[0])?e.datasets.forEach(function(e,o){(e.points||e.bars).forEach(function(e,n){e.value=t[o][n]})}):e.segments.forEach(function(e,o){e.value=t[o]}),e.update(),o.$emit("update",e),o.legend&&"false"!==o.legend&&v(n,e)}function C(e){return!e||Array.isArray(e)&&!e.length||"object"==typeof e&&!Object.keys(e).length}function b(n,r){var l=e.extend({},t.defaults.global,o.getOptions(n),r.options);return l.responsive}return function(t){return{restrict:"CA",scope:{data:"=?",labels:"=?",options:"=?",series:"=?",colours:"=?",getColour:"=?",chartType:"=",legend:"@",click:"=?",hover:"=?",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColours:"=?",chartLegend:"@",chartClick:"=?",chartHover:"=?"},link:function(a,s){function h(e,t){a.$watch(e,function(e){"undefined"!=typeof e&&(a[t]=e)})}function p(o,n){if(!C(o)&&!e.equals(o,n)){var r=t||a.chartType;r&&(w&&w.destroy(),d(r))}}function d(t){if(b(t,a)&&0===s[0].clientHeight&&0===y.clientHeight)return n(function(){d(t)},50,!1);if(a.data&&a.data.length){a.getColour="function"==typeof a.getColour?a.getColour:u,a.colours=c(t,a);var r=s[0],l=r.getContext("2d"),h=Array.isArray(a.data[0])?g(a.labels,a.data,a.series||[],a.colours):m(a.labels,a.data,a.colours),p=e.extend({},o.getOptions(t),a.options);w=new o.Chart(l)[t](h,p),a.$emit("create",w),r.onclick=a.click?i(a,w,"click",!1):e.noop,r.onmousemove=a.hover?i(a,w,"hover",!0):e.noop,a.legend&&"false"!==a.legend&&v(s,w)}}function f(e){if("undefined"!=typeof console&&"test"!==o.getOptions().env){var t="function"==typeof console.warn?console.warn:console.log;a[e]&&t.call(console,'"%s" is deprecated and will be removed in a future version. Please use "chart-%s" instead.',e,e)}}var w,y=document.createElement("div");y.className="chart-container",s.replaceWith(y),y.appendChild(s[0]),r&&window.G_vmlCanvasManager.initElement(s[0]),["data","labels","options","series","colours","legend","click","hover"].forEach(f),h("chartData","data"),h("chartLabels","labels"),h("chartOptions","options"),h("chartSeries","series"),h("chartColours","colours"),h("chartLegend","legend"),h("chartClick","click"),h("chartHover","hover"),a.$watch("data",function(e,o){if(e&&e.length&&(!Array.isArray(e[0])||e[0].length)){var n=t||a.chartType;if(n){if(w){if(l(e,o))return $(w,e,a,s);w.destroy()}d(n)}}},!0),a.$watch("series",p,!0),a.$watch("labels",p,!0),a.$watch("options",p,!0),a.$watch("colours",p,!0),a.$watch("chartType",function(t,o){C(t)||e.equals(t,o)||(w&&w.destroy(),d(t))}),a.$on("$destroy",function(){w&&w.destroy()})}}}}t.defaults.global.responsive=!0,t.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>",t.defaults.global.colours=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var r="object"==typeof window.G_vmlCanvasManager&&null!==window.G_vmlCanvasManager&&"function"==typeof window.G_vmlCanvasManager.initElement;return r&&(t.defaults.global.animation=!1),e.module("chart.js",[]).provider("ChartJs",o).factory("ChartJsFactory",["ChartJs","$timeout",n]).directive("chartBase",["ChartJsFactory",function(e){return new e}]).directive("chartLine",["ChartJsFactory",function(e){return new e("Line")}]).directive("chartBar",["ChartJsFactory",function(e){return new e("Bar")}]).directive("chartRadar",["ChartJsFactory",function(e){return new e("Radar")}]).directive("chartDoughnut",["ChartJsFactory",function(e){return new e("Doughnut")}]).directive("chartPie",["ChartJsFactory",function(e){return new e("Pie")}]).directive("chartPolarArea",["ChartJsFactory",function(e){return new e("PolarArea")}])});(function(){angular.module("app.common",[])})();(function(){angular.module("app.common").factory("pollsService",e);e.$inject=["$http","authentication"];function e(e,t){function o(){return e.get("/api/polls")}function n(t){return e.get("/api/polls/"+t)}function r(t){return e.get("/api/polls/user/"+t)}function l(o){return e.post("/api/polls",o,{headers:{Authorization:"Bearer "+t.getToken()}})}function a(o,n){return e.post("/api/polls/"+n+"/choices",o,{headers:{Authorization:"Bearer "+t.getToken()}})}function i(o){return e.delete("/api/polls/"+o,{headers:{Authorization:"Bearer "+t.getToken()}})}function c(t,o){return e.delete("/api/polls/"+t+"/choices/"+o)}function s(t,o){return e.put("/api/polls/"+t+"/choices/"+o)}return{getPolls:o,getOnePoll:n,getPollsByUserId:r,createPoll:l,createPollChoice:a,deletePoll:i,deletePollChoice:c,updateVote:s}}})();(function(){angular.module("app.common").service("authentication",e);e.$inject=["$window","$http","$q"];function e(e,t,o){function n(t){e.localStorage["poll-token"]=t}function r(){return e.localStorage["poll-token"]}function l(e){var r=o.defer();t.post("/api/register",e).then(function(e){n(e.data.token);r.resolve(e.data)}).catch(function(e){console.log(e);r.reject(e)});return r.promise}function a(e){var r=o.defer();t.post("/api/login",e).then(function(e){n(e.data.token);r.resolve(e.data)}).catch(function(e){r.reject(e)});return r.promise}function i(){var t=r();if(t){var o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}}function c(){if(i()){var t=r();var o=JSON.parse(e.atob(t.split(".")[1]));return{id:o._id,email:o.email,name:o.name}}}function s(){e.localStorage.removeItem("poll-token")}return{saveToken:n,getToken:r,register:l,login:a,logout:s,isLoggedIn:i,currentUser:c}}})();(function(){"use strict";angular.module("app.common").directive("plNavbar",e);function e(){return{templateUrl:"/common/directives/navbar.html",restrict:"E",controller:t,controllerAs:"vm"}}t.$inject=["$rootScope","$location","authentication"];function t(e,t,o){var n=this;n.isLoggedIn=o.isLoggedIn();n.currentUser=o.currentUser();n.logout=function(){o.logout();t.path("/")};e.$on("$routeChangeSuccess",function(e,t){n.isLoggedIn=o.isLoggedIn();n.currentUser=o.currentUser()})}})();(function(){"use strict";angular.module("app.common").directive("plFooter",e);function e(){return{templateUrl:"/common/directives/footer.html",restrict:"E"}}})();(function(){"use strict";angular.module("app.auth",[])})();(function(){"use strict";angular.module("app.auth").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/register",{templateUrl:"/auth/register.html",controller:"registerController",controllerAs:"vm"});e.when("/login",{templateUrl:"/auth/login.html",controller:"loginController",controllerAs:"vm"})}})();(function(){"use strict";angular.module("app.auth").controller("registerController",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.user={name:"",email:"",password:""};o.error=null;o.register=function(){t.register(o.user).then(function(t){e.path("/dashboard")}).catch(function(e){o.error=e.statusText})}}})();(function(){"use strict";angular.module("app.auth").controller("loginController",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.user={email:"",password:""};o.error=null;o.login=function(){t.login(o.user).then(function(t){e.path("/dashboard")}).catch(function(e){o.error=e.statusText})}}})();(function(){"use strict";angular.module("app.pollDashboard",[])})();(function(){"use strict";angular.module("app.pollDashboard").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/dashboard",{templateUrl:"/pollDashBoard/pollDashboard.html",controller:"pollDashboardController",controllerAs:"vm",resolve:{user:t}});e.when("/dashboard/polls",{templateUrl:"/pollDashBoard/pollDashboardUser.html",controller:"pollDashboardUserController",controllerAs:"vm",resolve:{user:t}});e.when("/dashboard/polls/:pollid",{templateUrl:"/pollDashBoard/pollDashboardEdit.html",controller:"pollDashboardEditController",controllerAs:"vm",resolve:{user:t}});e.when("/dashboard/polls/share/:pollid",{templateUrl:"/pollDashBoard/pollDashboardShare.html",controller:"pollDashboardShareController",controllerAs:"vm"});e.when("/dashboard/polls/share/result/:pollid",{templateUrl:"/pollDashBoard/pollDashboardResult.html",controller:"pollDashboardResultController",controllerAs:"vm"})}t.$inject=["authentication","$q"];function t(e,t){var o=t.defer();if(e.isLoggedIn()){o.resolve(true)}else{o.reject("Authorization Required")}return o.promise}})();(function(){"use strict";angular.module("app.pollDashboard").controller("pollDashboardController",e);e.$inject=["pollsService","$timeout"];function e(e,t){var o=this;o.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};o.isCreated=null;o.addMoreChoice=function(){if(o.poll.choices.length<5){o.poll.choices.push({answer:"",votes:0})}};o.removeChoice=function(e){if(o.poll.choices.length>2){o.poll.choices.splice(e,1)}};o.submitPoll=function(){return e.createPoll(o.poll).then(function(e){console.log("poll was created");o.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};o.isCreated=true;t(function(){o.isCreated=null},1500)}).catch(function(e){console.log(e);o.poll={question:"",choices:[{answer:"",votes:0},{answer:"",votes:0}]};o.isCreated=false;t(function(){o.isCreated=null},1500)})}}})();(function(){"use strict";angular.module("app.pollDashboard").controller("pollDashboardUserController",e);e.$inject=["pollsService","authentication","$location"];function e(e,t,o){var n=this;n.userPolls;n.pollLink=null;n.sharePoll=function(e){if(o.port()){n.pollLink=o.protocol()+"://"+o.host()+":"+o.port()+"/dashboard/polls/share/"+e}else{n.pollLink=o.protocol()+"://"+o.host()+"/dashboard/polls/share/"+e}};n.editPoll=function(e){o.path("/dashboard/polls/"+e)};n.deletePoll=function(t){return e.deletePoll(t).then(function(e){r()}).catch(function(e){console.log("unable to delete poll "+e)})};function r(){return e.getPollsByUserId(t.currentUser().id).then(function(e){n.userPolls=e.data}).catch(function(e){console.log(e)})}r()}})();(function(){"use strict";angular.module("app.pollDashboard").controller("pollDashboardShareController",e);e.$inject=["pollsService","$location","$routeParams"];function e(e,t,o){var n=this;n.poll;n.userChoice={};n.vote=function(){if(typeof n.userChoice==="string"){var o=n.poll.choices[parseInt(n.userChoice)]._id;e.updateVote(n.poll._id,o).then(function(e){console.log(e);t.path("/dashboard/polls/share/result/"+n.poll._id)}).catch(function(e){console.log(e)})}};n.results=function(){t.path("/dashboard/polls/share/result/"+n.poll._id)};function r(){e.getOnePoll(o.pollid).then(function(e){n.poll=e.data}).catch(function(e){console.log(e)})}r()}})();(function(){"use strict";angular.module("app.pollDashboard").controller("pollDashboardResultController",e);e.$inject=["$routeParams","pollsService"];function e(e,t){var o=this;o.labels=[];o.data=[];o.poll;function n(){t.getOnePoll(e.pollid).then(function(e){var t=[];o.poll=e.data;angular.forEach(o.poll.choices,function(e,n){o.labels.push(e.answer);t.push(e.votes)});o.data.push(t)}).catch(function(e){console.log("poll was not retrieved "+e)})}n()}})();(function(){"use strict";angular.module("app.landing",[])})();(function(){"use strict";angular.module("app.landing").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/",{templateUrl:"/landing/landing.html"})}})();(function(){"use strict";angular.module("app.landing").controller("landingController",e);e.$inject=["authentication"];function e(e){vm.isLoggedIn=e.isLoggedIn()}})();(function(){"use strict";angular.module("app.home",[])})();(function(){"use strict";angular.module("app.home").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/home",{templateUrl:"/home/home.html",controller:"homeController",controllerAs:"vm"});e.when("/home/result/:pollid",{templateUrl:"/home/homeResult.html",controller:"homeResultController",controllerAs:"vm"})}})();(function(){"use strict";angular.module("app.home").controller("homeController",e);e.$inject=["pollsService","$location"];function e(e,t){var o=this;o.polls;o.userChoices=[];o.vote=function(n,r){var l;var a;if(typeof o.userChoices[r]!=="object"){a=n.choices[parseInt(o.userChoices[r])]._id;l=n._id;e.updateVote(l,a).then(function(e){t.path("/home/result/"+n._id)}).catch(function(e){})}};o.results=function(e){t.path("/home/result/"+e._id)};function n(){return e.getPolls().then(function(e){o.polls=e.data;angular.forEach(o.polls,function(){o.userChoices.push({})})}).catch(function(e){console.log("Polls were not able to be returned "+e)})}n()}})();(function(){"use strict";angular.module("app.home").controller("homeResultController",e);e.$inject=["$routeParams","pollsService"];function e(e,t){var o=this;o.labels=[];o.data=[];o.poll;function n(){t.getOnePoll(e.pollid).then(function(e){var t=[];o.poll=e.data;angular.forEach(o.poll.choices,function(e,n){o.labels.push(e.answer);t.push(e.votes)});o.data.push(t)}).catch(function(e){console.log("poll was not retrieved "+e)})}n()}})();